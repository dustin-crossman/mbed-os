stages:
  - test
before_script:
    - pwd
    - mkdir ./targets/TARGET_Cypress/TARGET_PSOC6/sb-tools/keys
    - python -m pip install -r ./requirements.txt
    - curl.exe --insecure --connect-time 10 --show-error https://confluence.cypress.com/download/attachments/71434156/dev_default_keys.zip?api=v2 -o targets/TARGET_Cypress/TARGET_PSOC6/sb-tools/keys/def_keys.zip
    - Expand-Archive targets/TARGET_Cypress/TARGET_PSOC6/sb-tools/keys/def_keys.zip -DestinationPath targets/TARGET_Cypress/TARGET_PSOC6/sb-tools/keys/

.mbed_062_crypto:
  stage: test
  tags:
    - MBED_TEST
  script:
    - echo "CY8CKIT_062_WIFI_BT"
    - mbed test -m CY8CKIT_062_WIFI_BT -t GCC_ARM -n tests-mbedtls* -vv
    - echo "CY8CPROTO_062_4343W"
    - mbed test -m CY8CPROTO_062_4343W -t GCC_ARM -n tests-mbedtls* -vv


# TESTS ON WINDOWS 

win_IAR_064S2_tests:
  stage: test
  tags:
    - MBED_TEST
  script:
    - mbed test --compile -m CY8CKIT_064S2_4343W -t IAR -n TESTS-mbed_hal-common_tickers_freq,TESTS-mbed_hal-pinmap,TESTS-mbed_hal-rtc_reset,TESTS-mbed_hal-flash,TESTS-mbed_hal-common_tickers,TESTS-mbed_hal-lp_ticker,TESTS-mbed_drivers-lp_ticker,TESTS-mbed_drivers-rtc -v
    

win_IAR_064_tests:
  stage: test
  tags:
    - MBED_TEST
  script:
    - mbedls -m 1907:CY8CPROTO_064_SB
    - mbed test --compile -m CY8CPROTO_064_SB -t IAR -n TESTS-mbed_hal-pinmap,TESTS-mbed_hal-rtc_reset,TESTS-mbed_hal-flash,TESTS-mbed_hal-common_tickers,TESTS-mbed_hal-lp_ticker,TESTS-mbed_drivers-lp_ticker,TESTS-mbed_drivers-rtc -v 
    - mbedgt -n TESTS-mbed_hal-pinmap,TESTS-mbed_hal-rtc_reset,TESTS-mbed_hal-flash,TESTS-mbed_hal-common_tickers,TESTS-mbed_hal-lp_ticker,TESTS-mbed_drivers-lp_ticker,TESTS-mbed_drivers-rtc --use-tids 19071301651316170365131600000000000000002e127069 -vv


.win_GCC_ARM_064_tests:
  stage: test
  tags:
    - MBED_TEST
  script:
    - mbedls -m 1907:CY8CPROTO_064_SB
    - mbed test --compile -m CY8CPROTO_064_SB -t GCC_ARM -n TESTS-mbed_hal-pinmap,TESTS-mbed_hal-rtc_reset,TESTS-mbed_hal-flash,TESTS-mbed_hal-common_tickers,TESTS-mbed_hal-lp_ticker,TESTS-mbed_drivers-lp_ticker,TESTS-mbed_drivers-rtc -v
    - mbedgt -n TESTS-mbed_hal-pinmap,TESTS-mbed_hal-rtc_reset,TESTS-mbed_hal-flash,TESTS-mbed_hal-common_tickers,TESTS-mbed_hal-lp_ticker,TESTS-mbed_drivers-lp_ticker,TESTS-mbed_drivers-rtc --use-tids 19071301651316170365131600000000000000002e127069 -vv
    
    
    
    
    
    
# TESTS ON MAC OS X v 10.14
    
    
mac_GCC_ARM_064_tests:
  stage: test
  tags:
    - MBED_TEST_MAC1014
  before_script:
    - pwd
    - mkdir ./targets/TARGET_Cypress/TARGET_PSOC6/sb-tools/keys/
    - curl --insecure --connect-time 10 --show-error https://confluence.cypress.com/download/attachments/71434156/dev_default_keys.zip?api=v2 -o ./targets/TARGET_Cypress/TARGET_PSOC6/sb-tools/keys/dev_default_keys.zip
    - cd ./targets/TARGET_Cypress/TARGET_PSOC6/sb-tools/keys
    - unzip dev_default_keys.zip
    - export https_proxy=http://proxy.ua.cypress.com:8080
    - python3 --version 
    - cd ../../../../../
    - pwd     
  script:
    - mbedls -m 1907:CY8CPROTO_064_SB
    - mbedls 
    - mbed test --compile -m CY8CPROTO_064_SB -t GCC_ARM -n TESTS-mbed_hal-pinmap,TESTS-mbed_hal-rtc_reset,TESTS-mbed_hal-flash,TESTS-mbed_hal-common_tickers,TESTS-mbed_hal-lp_ticker,TESTS-mbed_drivers-lp_ticker,TESTS-mbed_drivers-rtc -vv
    - mbedgt -n TESTS-mbed_hal-pinmap,TESTS-mbed_hal-rtc_reset,TESTS-mbed_hal-flash,TESTS-mbed_hal-common_tickers,TESTS-mbed_hal-lp_ticker,TESTS-mbed_drivers-lp_ticker,TESTS-mbed_drivers-rtc --use-tids 190713012101070b0221010700000000000000002e127069 -vv
    
mac_GCC_ARM_064S2_tests:
  stage: test
  tags:
    - MBED_TEST_MAC1014
  before_script:
    - pwd
    - mkdir ./targets/TARGET_Cypress/TARGET_PSOC6/sb-tools/keys/
    - curl --insecure --connect-time 10 --show-error https://confluence.cypress.com/download/attachments/71434156/dev_default_keys.zip?api=v2 -o ./targets/TARGET_Cypress/TARGET_PSOC6/sb-tools/keys/dev_default_keys.zip
    - cd ./targets/TARGET_Cypress/TARGET_PSOC6/sb-tools/keys
    - unzip dev_default_keys.zip
    - export https_proxy=http://proxy.ua.cypress.com:8080
    - python3 --version 
    - cd ../../../../../
    - pwd     
  script:
    - mbedls -m 190A:CY8CKIT_064S2_4343W
    - mbedls
    - mbed test --compile --build OUT/CY8CKIT_064S2_4343W -m CY8CKIT_064S2_4343W -t GCC_ARM -n TESTS-mbed_hal-common_tickers_freq,TESTS-mbed_hal-pinmap,TESTS-mbed_hal-rtc_reset,TESTS-mbed_hal-flash,TESTS-mbed_hal-common_tickers,TESTS-mbed_hal-lp_ticker,TESTS-mbed_drivers-lp_ticker,TESTS-mbed_drivers-rtc -vv
    - mbedgt --test-spec OUT/CY8CKIT_064S2_4343W/test_spec.json -e "TESTS/host_tests" -n TESTS-mbed_hal-common_tickers_freq,TESTS-mbed_hal-pinmap,TESTS-mbed_hal-rtc_reset,TESTS-mbed_hal-flash,TESTS-mbed_hal-common_tickers,TESTS-mbed_hal-lp_ticker,TESTS-mbed_drivers-lp_ticker,TESTS-mbed_drivers-rtc --use-tids 190A13016c131c0b036c131c00000000000000002e127069 -vv

mac_ARMC6_064_tests:
  stage: test
  tags:
    - MBED_TEST_MAC1014
  before_script:
    - pwd
    - mkdir ./targets/TARGET_Cypress/TARGET_PSOC6/sb-tools/keys/
    - curl --insecure --connect-time 10 --show-error https://confluence.cypress.com/download/attachments/71434156/dev_default_keys.zip?api=v2 -o ./targets/TARGET_Cypress/TARGET_PSOC6/sb-tools/keys/dev_default_keys.zip
    - cd ./targets/TARGET_Cypress/TARGET_PSOC6/sb-tools/keys
    - unzip dev_default_keys.zip
    - export https_proxy=http://proxy.ua.cypress.com:8080
    - python3 --version 
    - cd ../../../../../
    - pwd     
  script:
    - mbedls -m 1907:CY8CPROTO_064_SB
    - mbedls
    - export ARMLMD_LICENSE_FILE=/Library/Application\ Support/Mbed\ Studio/mbed-studio-tools/ac6-license.dat
    - mbed test --compile -m CY8CPROTO_064_SB -t ARMC6 -n TESTS-mbed_hal-pinmap,TESTS-mbed_hal-rtc_reset,TESTS-mbed_hal-flash,TESTS-mbed_hal-common_tickers,TESTS-mbed_hal-lp_ticker,TESTS-mbed_drivers-lp_ticker,TESTS-mbed_drivers-rtc -vv
    - mbedgt -n TESTS-mbed_hal-pinmap,TESTS-mbed_hal-rtc_reset,TESTS-mbed_hal-flash,TESTS-mbed_hal-common_tickers,TESTS-mbed_hal-lp_ticker,TESTS-mbed_drivers-lp_ticker,TESTS-mbed_drivers-rtc --use-tids 190713012101070b0221010700000000000000002e127069 -vv
    
mac_ARMC6_064S2_tests:
  stage: test
  tags:
    - MBED_TEST_MAC1014
  before_script:
    - pwd
    - mkdir ./targets/TARGET_Cypress/TARGET_PSOC6/sb-tools/keys/
    - curl --insecure --connect-time 10 --show-error https://confluence.cypress.com/download/attachments/71434156/dev_default_keys.zip?api=v2 -o ./targets/TARGET_Cypress/TARGET_PSOC6/sb-tools/keys/dev_default_keys.zip
    - cd ./targets/TARGET_Cypress/TARGET_PSOC6/sb-tools/keys
    - unzip dev_default_keys.zip
    - export https_proxy=http://proxy.ua.cypress.com:8080
    - python3 --version 
    - cd ../../../../../
    - pwd     
  script:
    - mbedls -m 190A:CY8CKIT_064S2_4343W
    - mbedls
    - export ARMLMD_LICENSE_FILE=/Library/Application\ Support/Mbed\ Studio/mbed-studio-tools/ac6-license.dat
    - mbed test --compile --build OUT/CY8CKIT_064S2_4343W/ -m CY8CKIT_064S2_4343W -t ARMC6 -n TESTS-mbed_hal-pinmap,TESTS-mbed_hal-rtc_reset,TESTS-mbed_hal-flash,TESTS-mbed_hal-common_tickers,TESTS-mbed_hal-lp_ticker,TESTS-mbed_drivers-lp_ticker,TESTS-mbed_drivers-rtc -vv    
    - mbedgt --test-spec OUT/CY8CKIT_064S2_4343W/test_spec.json -e "TESTS/host_tests" -n TESTS-mbed_hal-common_tickers_freq,TESTS-mbed_hal-pinmap,TESTS-mbed_hal-rtc_reset,TESTS-mbed_hal-flash,TESTS-mbed_hal-common_tickers,TESTS-mbed_hal-lp_ticker,TESTS-mbed_drivers-lp_ticker,TESTS-mbed_drivers-rtc --use-tids 190A13016c131c0b036c131c00000000000000002e127069 -vv
